/*
 * This file is part of Schumix.
 * 
 * Copyright (C) 2010-2011 Megax <http://www.megaxx.info/>
 * 
 * Schumix is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * Schumix is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with Schumix.  If not, see <http://www.gnu.org/licenses/>.
 */

using System;
using System.Text;
using System.Text.RegularExpressions;
using Schumix.API;
using Schumix.Framework;
using Schumix.Framework.Config;
using Schumix.Framework.Extensions;
using WolframAPI;

namespace Schumix.Irc.Commands
{
	public partial class CommandHandler
	{
		protected void HandleXbot(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);
			sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "3Verzi√≥: 10{0}", sUtilities.GetVersion());
			string parancsok = string.Empty;

			foreach(var command in CommandManager.GetPublicCommandHandler())
			{
				if(command.Key == "xbot")
					continue;

				parancsok += " | " + IRCConfig.CommandPrefix + command.Key;
			}

			sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "3Parancsok: {0}", parancsok.Remove(0, 3, " | "));
			sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Programmed by: 3Csaba");
		}

		protected void HandleInfo(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);
			sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Programoz√≥m: Csaba, Jackneill.");
		}

		protected void HandleIdo(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);

			if(DateTime.Now.Minute < 10)
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Helyi id≈ë: {0}:0{1}", DateTime.Now.Hour, DateTime.Now.Minute);
			else
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Helyi id≈ë: {0}:{1}", DateTime.Now.Hour, DateTime.Now.Minute);
		}

		protected void HandleDatum(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);
			string[,] Nevnap = new string[12,31] {
				{ "√öJ√âV","√Åbel","Genov√©va","Titusz","Simon","Boldizs√°r","Attila","Gy√∂ngyv√©r","Marcell","Mel√°nia","√Ågota","Ern≈ë","Veronika","B√≥dog","L√≥r√°nt","Guszt√°v","Antal","Piroska","S√°ra","Sebesty√©n","√Ågnes","Vince","Zelma","Tim√≥t","P√°l","Vanda","Angelika","K√°roly,","Ad√©l","Martina","Marcella" },
				{ "Ign√°c","Karolina","Bal√°zs","R√°hel","√Ågota","D√≥ra","T√≥dor","Aranka","Abig√©l","Elvira","Bertold","L√≠via","Ella, Linda","B√°lint","Kolos","Julianna","Don√°t","Bernadett","Zsuzsanna","√Ålmos","Eleon√≥ra","Gerzson","Alfr√©d","M√°ty√°s","G√©za","Edina","√Åkos, B√°tor","Elem√©r","","","" },
				{ "Albin","Lujza","Korn√©lia","K√°zm√©r","Adorj√°n","Leon√≥ra","Tam√°s","Zolt√°n","Franciska","Ildik√≥","Szil√°rd","Gergely","Kriszti√°n, Ajtony","Matild","Krist√≥f","Henrietta","Gertr√∫d","S√°ndor","J√≥zsef","Klaudia","Benedek","Be√°ta","Em≈ëke","G√°bor","Ir√©n","Em√°nuel","Hajnalka","Gedeon","Auguszta","Zal√°n","√Årp√°d" },
				{ "Hug√≥","√Åron","Buda, Rich√°rd","Izidor","Vince","Vilmos, B√≠borka","Herman","D√©nes","Erhard","Zsolt","Zsolt, Le√≥","Gyula","Ida","Tibor","Tas, Anaszt√°zia","Csongor","Rudolf","Andrea","Emma","Konr√°d, Tivadar","Konr√°d","Csilla","B√©la","Gy√∂rgy","M√°rk","Ervin","Zita","Val√©ria","P√©ter","Katalin, Kitti","" },
				{ "F√ºl√∂p","Zsigmond","T√≠mea","M√≥nika","Gy√∂rgyi","Ivett","Gizella","Mih√°ly","Gergely","√Årmin","Ferenc","Pongr√°c","Szerv√°c","Bonif√°c","Zs√≥fia","Botond, M√≥zes","Paszk√°l","Erik","Iv√≥, Mil√°n","Bern√°t, Fel√≠cia","Konstantin","J√∫lia, Rita","Dezs≈ë","Eszter","Orb√°n","F√ºl√∂p","Hella","Emil, Csan√°d","Magdolna","Zsanett, Janka","Ang√©la" },
				{ "T√ºnde","Anita, K√°rmen","Klotild","Bulcs√∫","Fatime","Norbert","R√≥bert","Med√°rd","F√©lix","Margit","Barnab√°s","Vill≈ë","Antal, Anett","Vazul","Jol√°n","Jusztin","Laura","Levente","Gy√°rf√°s","Rafael","Alajos","Paulina","Zolt√°n","Iv√°n","Vilmos","J√°nos","L√°szl√≥","Levente, Ir√©n","P√©ter, P√°l","P√°l","" },
				{ "Annam√°ria","Ott√≥","Korn√©l","Ulrik","Sarolta, Emese","Csaba","Appol√≥nia","Ell√°k","Lukr√©cia","Am√°lia","N√≥ra, Lili","Izabella","Jen≈ë","&≈êrs","Henrik","Valter","Endre, Elek","Frigyes","Em√≠lia","Ill√©s","D√°niel","Magdolna","Lenke","Kinga, Kincs≈ë","Krist√≥f, Jakab","Anna, Anik√≥","Olga","Szabolcs","M√°rta","Judit","Oszk√°r" },
				{ "Bogl√°rka","Lehel","Hermina","Domonkos","Krisztina","Berta","Ibolya","L√°szl√≥","Em≈ëd","L√∂rinc","Zsuzsanna","Kl√°ra","Ipoly","Marcell","M√°ria","√Åbrah√°m","J√°cint","Ilona","Huba","Istv√°n","S√°muel","Menyh√©rt","Bence","Bertalan","Lajos","Izs√≥","G√°sp√°r","√Ågoston","Beatrix","R√≥zsa","Erika" },
				{ "Egon","Rebeka","Hilda","Roz√°lia","Viktor, L≈ërinc","Zakari√°s","Regina","M√°ria","√Åd√°m","Nikolett, Hunor","Teod√≥ra","M√°ria","Korn√©l","Szer√©na","Enik≈ë","Edit","Zs√≥fia","Di√°na","Vilhelmina","Friderika","M√°t√©","M√≥ric","Tekla","Gell√©rt","Eufrozina","Jusztina","Adalbert","Vencel","Mih√°ly","Jeromos","" },
				{ "Malvin","Petra","Helga","Ferenc","Aur√©l","Ren√°ta","Am√°lia","Kopp√°ny","D√©nes","Gedeon","Brigitta","Miksa","K√°lm√°n","Hel√©n","Ter√©z","G√°l","Hedvig","Luk√°cs","N√°ndor","Vendel","Orsolya","El≈ëd","Gy√∂ngyi","Salamon","Bianka","D√∂m√∂t√∂r","Szabina","Simon","N√°rcisz","Alfonz","Farkas" },
				{ "Marianna","Achilles","Gy≈ëz≈ë","K√°roly","Imre","L√©n√°rd","Rezs≈ë","Zsombor","Tivadar","R√©ka","M√°rton","J√≥n√°s, Ren√°t√≥","Szilvia","Aliz","Albert, Lip√≥t","√ñd√∂n","Hortenzia, Gerg≈ë","Jen≈ë","Erzs√©bet","Jol√°n","Oliv√©r","Cec√≠lia","Kelemen","Emma","Katalin","Vir√°g","Virgil","Stef√°nia","Taksony","Andr√°s, Andor","" },
				{ "Elza","Melinda","Ferenc","Barbara, Borb√°la","Vilma","Mikl√≥s","Ambrus","M√°ria","Nat√°lia","Judit","√Årp√°d","Gabriella","Luca","Szil√°rda","Val√©r","Etelka","L√°z√°r","Auguszta","Viola","Teofil","Tam√°s","Z√©no","Vikt√≥ria","√Åd√°m, √âva","KAR√ÅCSONY","KAR√ÅCSONY","J√°nos","Kamilla","Tam√°s","D√°vid","Szilveszter" },
			};

			int[] Honapok = new int[12] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12 };

			int Ev = DateTime.Now.Year;
			int Honap = DateTime.Now.Month;
			int Nap = DateTime.Now.Day;

			for(int x = 0; x < 12; x++)
			{
				int honapdb = Honapok[x];
				string napdb = Nevnap[x,DateTime.Now.Day-1];

				if(Honap == honapdb)
				{
					if(Honap < 10)
					{
						if(Nap < 10)
							sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Ma {0}. 0{1}. 0{2}. {3} napja van.", Ev, Honap, Nap, napdb);
						else
							sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Ma {0}. 0{1}. {2}. {3} napja van.", Ev, Honap, Nap, napdb);
					}
					else
					{
						if(Nap < 10)
							sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Ma {0}. {1}. 0{2}. {3} napja van.", Ev, Honap, Nap, napdb);
						else
							sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Ma {0}. {1}. {2}. {3} napja van.", Ev, Honap, Nap, napdb);
					}
				}
		 	}
		}

		protected void HandleRoll(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);
			var rand = new Random();
			int szam = rand.Next(0, 100);
			sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Sz√°zal√©kos ar√°nya {0}%", szam);
		}

		protected void HandleCalc(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);

			if(sIRCMessage.Info.Length < 5)
			{
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Nincs param√©ter!");
				return;
			}

			var client = new WAClient("557QYQ-UUUWTKX95V");
			var solution = client.Solve(sIRCMessage.Info.SplitToString(4, " "));
			sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "{0}", solution);
		}

		protected void HandleSha1(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);

			if(sIRCMessage.Info.Length < 5)
			{
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Nincs param√©ter!");
				return;
			}

			sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, sUtilities.Sha1(sIRCMessage.Info.SplitToString(4, " ")));
		}

		protected void HandleMd5(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);

			if(sIRCMessage.Info.Length < 5)
			{
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Nincs param√©ter!");
				return;
			}

			sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, sUtilities.Md5(sIRCMessage.Info.SplitToString(4, " ")));
		}

		protected void HandleIrc(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);

			if(sIRCMessage.Info.Length < 5)
			{
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Nincs megadva a parancs neve!");
				return;
			}

			var db = SchumixBase.DManager.QueryFirstRow("SELECT Message FROM irc_commands WHERE command = '{0}'", sIRCMessage.Info[4]);
			if(!db.IsNull())
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, db["Message"].ToString());
			else
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Hib√°s lek√©rdez√©s!");
		}

		protected void HandleWhois(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);

			if(sIRCMessage.Info.Length < 5)
			{
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Nincs megadva a keresend≈ë szem√©ly neve!");
				return;
			}

			WhoisPrivmsg = sIRCMessage.Channel;
			sSender.Whois(sIRCMessage.Info[4]);
		}

		protected void HandleWarning(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);

			if(sIRCMessage.Info.Length < 5)
			{
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Nincs megadva a n√©v!");
				return;
			}

			if(sIRCMessage.Info.Length == 5)
				sSendMessage.SendCMPrivmsg(sIRCMessage.Info[4], "Keresnek t√©ged itt: {0}", sIRCMessage.Channel);
			else if(sIRCMessage.Info.Length >= 6)
				sSendMessage.SendCMPrivmsg(sIRCMessage.Info[4], "{0}", sIRCMessage.Info.SplitToString(5, " "));
		}

		protected void HandleKeres(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);

			if(sIRCMessage.Info.Length < 5)
			{
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Nincs megadva a keresend≈ë sz√∂veg!");
				return;
			}

			string url = sUtilities.GetUrl("http://ajax.googleapis.com/ajax/services/search/web?v=1.0&start=0&rsz=small&q=", sIRCMessage.Info.SplitToString(4, " "));
			var Regex = new Regex(@".unescapedUrl.\:.(?<url>\S+).,.url.+.titleNoFormatting.\:.(?<title>.+).,.content");

			if(!Regex.IsMatch(url))
			{
				sSendMessage.SendChatMessage(MessageType.PRIVMSG, sIRCMessage.Channel, "2Title: Nincs Title.");
				sSendMessage.SendChatMessage(MessageType.PRIVMSG, sIRCMessage.Channel, "2Link: Nincs Link.");
			}
			else
			{
				sSendMessage.SendChatMessage(MessageType.PRIVMSG, sIRCMessage.Channel, "2Title: {0}", Regex.Match(url).Groups["title"].ToString());
				sSendMessage.SendChatMessage(MessageType.PRIVMSG, sIRCMessage.Channel, "2Link: 3{0}", Regex.Match(url).Groups["url"].ToString());
			}
		}

		protected void HandleFordit(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);

			if(sIRCMessage.Info.Length < 5)
			{
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Nincs megadva melyik nyelvr≈ël melyikre ford√≠tsa le!");
				return;
			}

			if(sIRCMessage.Info.Length < 6)
			{
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Nincs megadva a ford√≠tand√≥ sz√∂veg!");
				return;
			}

			string url = sUtilities.GetUrl("http://ajax.googleapis.com/ajax/services/language/translate?v=1.0&q=", sIRCMessage.Info.SplitToString(5, " "), "&langpair=" + sIRCMessage.Info[4]);
			var Regex = new Regex(@"\{.translatedText.\:.(?<text>.+).\},");

			if(!Regex.IsMatch(url))
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Nincs f√≥rd√≠tott sz√∂veg.");
			else
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "{0}", Regex.Match(url).Groups["text"].ToString());
		}

		protected void HandlePrime(IRCMessage sIRCMessage)
		{
			CNick(sIRCMessage);

			if(sIRCMessage.Info.Length < 5)
			{
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Nincs megadva sz√°m!");
				return;
			}

			double Num;
			bool isNum = double.TryParse(sIRCMessage.Info[4], out Num);

			if(!isNum)
			{
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "Nem csak sz√°mot tartalmaz!");
				return;
			}

			bool prim = sUtilities.IsPrime(Convert.ToInt32(Num));

			if(!prim)
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "{0} nem primsz√°m.", sIRCMessage.Info[4]);
			else
				sSendMessage.SendCMPrivmsg(sIRCMessage.Channel, "{0} primsz√°m.", sIRCMessage.Info[4]);
		}
	}
}
